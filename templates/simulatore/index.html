{% extends 'base.html' %}
{% block title %}Simulatore{% endblock %}
{% block nav_class_home %}inactive{% endblock %}
{% block nav_class_simulatore %}active{% endblock %}
<!--{% block nav_class_carma %}inactive{% endblock %}-->
{% block corpo_centrale %}
	<div class="row">
		<div class="col-md-5">
			<div class="tabbable" id="tabs-474851">
				<ul class="nav nav-tabs">
					<li {% if tipo_take != 'take_variabile' %}class="active"{% endif %}>
						<a href="#panel-464241" data-toggle="tab">Take fisso</a>
					</li>
					<li {% if tipo_take == 'take_variabile' %}class="active"{% endif %}>
						<a href="#panel-68911" data-toggle="tab">Take variabile</a>
					</li>
				</ul>
				<div class="tab-content">
                    <div class="tab-pane {% if tipo_take != 'take_variabile' %}active{% endif %}" id="panel-464241">
                        <form role="form" method="post" class="form-horizontal" id="take_singolo">{% csrf_token %}
                        <input type="hidden" value="take_singolo" name="tipo_take">
                        <input type="hidden" id="selectedDate_inizio" name="selectedDate_inizio" {% if request.session.data_inizio %}value="{{ request.session.data_inizio }}" {% else %}value="{{ data_max }}"{% endif %} />
                        <input type="hidden" id="selectedDate_fine" name="selectedDate_fine" {% if request.session.data_fine %}value="{{ request.session.data_fine }}" {% else %}value="{{ data_oggi }}"{% endif %}/>
                            <div class="row">
                                <div class="col-md-12">
                                    {% if not user.is_authenticated %}
                                        <p>La versione gratuita ti permette di simulare a parametri fissi solo per gli ultimi 15 giorni.</p>
                                        <p>Per effettuare simulazioni su date più ampie e a parametri variabili richiedi l'accesso agli sviluppatori.</p>
                                    {% endif %}
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-md-3 form-group-sm">
                                    <label>
                                        {{ form_singolo.isin.label }}
                                        {{ form_singolo.isin }}
                                    </label>
                                </div>
                                <div class="col-md-3 form-group-sm">
                                    <label>
                                        {{ form_singolo.crea_data_inizio.label }}
                                        {{ form_singolo.crea_data_inizio }}
                                    </label>
                                </div>
                                <div class="col-md-3 form-group-sm">
                                    <label>
                                        {{ form_singolo.crea_data_fine.label }}
                                        {{ form_singolo.crea_data_fine }}
                                    </label>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-md-3 form-group-sm">
                                    <label>
                                        {{ form_singolo.crea_limite_inferiore.label }}
                                        {{ form_singolo.crea_limite_inferiore }}
                                    </label>
                                </div>
                                <div class="col-md-3 form-group-sm">
                                    <label>
                                        {{ form_singolo.crea_limite_superiore.label }}
                                        {{ form_singolo.crea_limite_superiore }}
                                    </label>
                                    {% if check2 == 'Yes' %}
                                    <small class="help-block" data-fv-for="crea_limite_superiore" data-fv-result="INVALID" style="display: block;">Il limite superiore è stato modificato per essere multiplo di limite inferiore e step</small>
                                    {% endif %}
                                </div>
                                <div class="col-md-3 form-group-sm">
                                    <label>
                                        {{ form_singolo.primo_acquisto.label }}
                                        {{ form_singolo.primo_acquisto }}
                                    </label>
                                    {% if check == 'Yes' %}
                                    <small class="help-block" data-fv-for="primo acquisto" data-fv-result="INVALID" style="display: block;">Il primo acquisto è stato modificato per essere multiplo di limite inferiore e step</small>
                                    {% endif %}
                                </div>
                                <div class="col-md-3 form-group-sm">
                                    <label>
                                        {{ form_singolo.in_carico.label }}
                                        {{ form_singolo.in_carico }}
                                    </label>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-md-3 form-group-sm">
                                    <label>
                                        {{ form_singolo.step.label }}
                                        {{ form_singolo.step }}
                                    </label>
                                </div>
                                <div class="col-md-3 form-group-sm">
                                    <label>
                                        {{ form_singolo.take.label }}
                                        {{ form_singolo.take }}
                                    </label>
                                </div>
                                <div class="col-md-3 form-group-sm">
                                    <label>
                                        {{ form_singolo.quantita_acquisto.label }}
                                        {{ form_singolo.quantita_acquisto }}
                                    </label>
                                </div>
                                <div class="col-md-3 form-group-sm">
                                    <label>
                                        {{ form_singolo.quantita_vendita.label }}
                                        {{ form_singolo.quantita_vendita }}
                                    </label>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-md-3 form-group-sm">
                                    <label>
                                        {{ form_singolo.commissioni_tipo.label }}
                                        {{ form_singolo.commissioni_tipo }}
                                    </label>
                                </div>
                                <div class="col-md-3 form-group-sm">
                                    <label>
                                        {{ form_singolo.commissioni_importo.label }}
                                        {{ form_singolo.commissioni_importo }}
                                    </label>
                                </div>
                                <div class="col-md-3 form-group-sm">
                                    <label>
                                        {{ form_singolo.commissioni_min.label }}
                                        {{ form_singolo.commissioni_min }}
                                    </label>
                                </div>
                                <div class="col-md-3 form-group-sm">
                                    <label>
                                        {{ form_singolo.commissioni_max.label }}
                                        {{ form_singolo.commissioni_max }}
                                    </label>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-md-3">
                                    <button type="button" class="btn btn-info" name="bottone" value="guida" id="bottone_guida">
                                    Guida
                                    </button>
                                </div>
                                <div class="col-md-3">
                                    <button type="submit" class="btn btn-primary" name="bottone" value="crea">
                                    Crea tappeto
                                    </button>
                                </div>
                                {% if bottone == 'crea' and tipo_take == 'take_singolo' %}
                                <div class="col-md-3">
                                    <button type="submit" class="btn btn-success" name="bottone" value="simula">
                                    Simula
                                    </button>
                                </div>
                                {% endif %}
                                <div class="col-md-3">
                                </div>
                            </div>
                        </form>
                    </div>
                    <div class="tab-pane {% if tipo_take == 'take_variabile' %}active{% endif %}" id="panel-68911">
						{% if user.is_authenticated %}
                        {% if perms.simulatore.take_variabile %}
                        <form role="form" method="post" class="form-horizontal" id="take_variabile">{% csrf_token %}
                            <input type="hidden" value="take_variabile" name="tipo_take">
                            <input type="hidden" id="selectedDate_variabile_inizio" name="selectedDate_variabile_inizio" {% if request.session.data_inizio %}value="{{ request.session.data_inizio }}" {% else %}value="{{ data_max }}"{% endif %} />
                            <input type="hidden" id="selectedDate_variabile_fine" name="selectedDate_variabile_fine" {% if request.session.data_fine %}value="{{ request.session.data_fine }}" {% else %}value="{{ data_oggi }}"{% endif %}/>
                            <div class="row">
                                <div class="col-md-3 form-group-sm">
                                    <label>
                                        {{ form_variabile.isin.label }}
                                        {{ form_variabile.isin }}
                                    </label>
                                </div>
                                <div class="col-md-3 form-group-sm">
                                    <label>
                                        {{ form_variabile.crea_data_inizio.label }}
                                        {{ form_variabile.crea_data_inizio }}
                                    </label>
                                </div>
                                <div class="col-md-3 form-group-sm">
                                    <label>
                                        {{ form_variabile.crea_data_fine.label }}
                                        {{ form_variabile.crea_data_fine }}
                                    </label>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-md-3 form-group-sm">
                                    <label>
                                        {{ form_variabile.crea_limite_inferiore.label }}
                                        {{ form_variabile.crea_limite_inferiore }}
                                    </label>
                                </div>
                                <div class="col-md-3 form-group-sm">
                                    <label>
                                        {{ form_variabile.crea_limite_superiore.label }}
                                        {{ form_variabile.crea_limite_superiore }}
                                    </label>
                                    {% if check2 == 'Yes' %}
                                    <small class="help-block" data-fv-for="crea_limite_superiore" data-fv-result="INVALID" style="display: block;">Il limite superiore è stato modificato per essere multiplo di limite inferiore e step</small>
                                    {% endif %}
                                </div>
                                <div class="col-md-3 form-group-sm">
                                    <label>
                                        {{ form_variabile.primo_acquisto.label }}
                                        {{ form_variabile.primo_acquisto }}
                                    </label>
                                    {% if check == 'Yes' %}
                                    <small class="help-block" data-fv-for="primo acquisto" data-fv-result="INVALID" style="display: block;">Il primo acquisto è stato modificato per essere multiplo di limite inferiore e step</small>
                                    {% endif %}
                                </div>
                                <div class="col-md-3 form-group-sm">
                                    <label>
                                        {{ form_variabile.in_carico.label }}
                                        {{ form_variabile.in_carico }}
                                    </label>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-md-3 form-group-sm">
                                    <label>
                                        {{ form_variabile.step.label }}
                                        {{ form_variabile.step }}
                                    </label>
                                </div>
                                <div class="col-md-3 form-group-sm">
                                    <label>
                                        {{ form_variabile.take_inizio.label }}
                                        {{ form_variabile.take_inizio }}
                                    </label>
                                </div>
                                <div class="col-md-3 form-group-sm">
                                    <label>
                                        {{ form_variabile.take_fine.label }}
                                        {{ form_variabile.take_fine }}
                                    </label>
                                </div>
                                <div class="col-md-3 form-group-sm">
                                    <label>
                                        {{ form_variabile.take_incremento.label }}
                                        {{ form_variabile.take_incremento }}
                                    </label>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-md-3 form-group-sm">
                                    <label>
                                        {{ form_variabile.quantita_acquisto.label }}
                                        {{ form_variabile.quantita_acquisto }}
                                    </label>
                                </div>
                                <div class="col-md-3 form-group-sm">
                                    <label>
                                        {{ form_variabile.quantita_vendita.label }}
                                        {{ form_variabile.quantita_vendita }}
                                    </label>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-md-3 form-group-sm">
                                    <label>
                                        {{ form_variabile.commissioni_tipo.label }}
                                        {{ form_variabile.commissioni_tipo }}
                                    </label>
                                </div>
                                <div class="col-md-3 form-group-sm">
                                    <label>
                                        {{ form_variabile.commissioni_importo.label }}
                                        {{ form_variabile.commissioni_importo }}
                                    </label>
                                </div>
                                <div class="col-md-3 form-group-sm">
                                    <label>
                                        {{ form_variabile.commissioni_min.label }}
                                        {{ form_variabile.commissioni_min }}
                                    </label>
                                </div>
                                <div class="col-md-3 form-group-sm">
                                    <label>
                                        {{ form_variabile.commissioni_max.label }}
                                        {{ form_variabile.commissioni_max }}
                                    </label>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-md-3">
                                    <button type="button" class="btn btn-info" name="bottone" value="guida" id="bottone_guida_2">
                                    Guida
                                    </button>
                                </div>
                                <div class="col-md-3">
                                    <button type="submit" class="btn btn-primary" name="bottone" value="crea">
                                    Crea tappeto
                                    </button>
                                </div>
                                {% if bottone == 'crea' and tipo_take == 'take_variabile' %}
                                <div class="col-md-3">
                                    <button type="submit" class="btn btn-success" name="bottone" value="simula">
                                    Simula
                                    </button>
                                </div>
                                {% endif %}
                                <div class="col-md-3">
                                </div>
                            </div>
                        </form>
                        {% else %}
                         <div class="row">
                             <div class="col-md-12 form-group-sm">
                                 <br/>
                                 <p>Non hai i permessi per eseguire simulazioni con parametri variabili. Contatta gli sviluppatori per richiedere l'accesso.</p>
                            </div>
                         </div>
                        {% endif %}
                        {% else %}
                        <div class="row">
                            <div class="col-md-12 form-group-sm">
                                <br/>
                                <p>Non sei loggato. Loggati o registrati per poter effettuare simulazioni con parametri variabili.</p>
                            </div>
                         </div>
                        {% endif %}
					</div>
				</div>
			</div>
            <div class="col-md-6" {{ mostra_risultati }}>
                <br />
			    {% for singolo_tappeto in tappeto %}
                <div class="panel panel-success" {% if not singolo_tappeto.take == best_take %}style="display: none"{% endif %} id="dettagli_simulazione_{{ singolo_tappeto.take|cut:"." }}">
                    <div class="panel-heading">
                        <h3 class="panel-title"><strong>Risultato simulazione {{ isin }}</strong></h3>
                    </div>
                    <table class="table table-condensed table-hover stripe table-sommario-tappeto">
                        <tbody>
                            <tr>
                                <td>
                                    Storico
                                </td>
                                <td>
                                    {{ data_inizio }} - {{ data_fine }}
                                </td>
                            </tr>
                            <tr>
                                <td>
                                    Take
                                </td>
                                <td>
                                    &euro; {{ singolo_tappeto.take }}
                                </td>
                            </tr>
                            <tr>
                                <td>
                                    Esposizione max tappeto long
                                </td>
                                <td>
                                    &euro; {{ singolo_tappeto.valore_carico_long }}
                                </td>
                            </tr>
                            <tr>
                                <td>
                                    Esposizione max tappeto short
                                </td>
                                <td>
                                    &euro; {{ singolo_tappeto.valore_carico_short }}
                                </td>
                            </tr>
                            <tr>
                                <td>
                                    Valore max reale tappeto
                                </td>
                                <td>
                                    &euro; {{ singolo_tappeto.valore_max }}
                                </td>
                            </tr>
                            <tr>
                                <td>
                                    Valore finale tappeto
                                </td>
                                <td>
                                    &euro; {{ singolo_tappeto.valore_attuale }}
                                </td>
                            </tr>
                            <tr>
                                <td>
                                    Acquisti
                                </td>
                                <td>
                                    {{ singolo_tappeto.nr_acquisti }}
                                </td>
                            </tr>
                            <tr>
                                <td>
                                    Vendite
                                </td>
                                <td>
                                    {{ singolo_tappeto.nr_vendite }}
                                </td>
                            </tr>-
                            <tr>
                                <td>
                                    Gain
                                </td>
                                <td>
                                    &euro; {{ singolo_tappeto.gain }}
                                </td>
                            </tr>
                            <tr>
                                <td>
                                    Commissioni
                                </td>
                                <td>
                                    &euro; {{ singolo_tappeto.commissioni }}
                                </td>
                            </tr>
                            <tr>
                                <td>
                                    Profitto
                                </td>
                                <td>
                                    &euro; {{ singolo_tappeto.profitto }}
                                </td>
                            </tr>
                            <tr class="success">
                                <td>
                                    <strong>Rendimento reale</strong>
                                </td>
                                <td>
                                    <strong>{{ singolo_tappeto.rendimento }}%</strong>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                {% endfor %}
            </div>
            <div class="col-md-6" {{ mostra_risultati }}>
                {% if bottone == 'simula' and tipo_take == 'take_variabile' %}
                    <br />
                    <p>Nella tabella in alto a destra trovi il risultato della simulazione a take variabile. Ogni riga corrisponde a un tappeto con un take diverso.</p>
                    <p>La tabella è ordinata per rendimento, quindi la prima riga in alto ti mostra il tappeto migliore.</p>
                    <p>Se clicchi sui nomi delle colonne della tabella puoi cambiare l'ordine della tabella.</p>
                    <p><strong>Clicca su una riga della tabella in alto a destra per aggiornare il riepilogo del tappeto qui accanto e l'elenco delle operazioni qui sotto.</strong></p>
                {% elif bottone == 'crea' and tipo_take == 'take_variabile' %}
                    <br />
                    <p>Nella tabella in alto a destra trovi la struttura del tappeto che hai appena creato.</p>
                    <p>A titolo di esempio è riportato solo il tappeto con il take iniziale della simulazione.</p>
                    <p><strong>Se la struttura corrisponde a quello che vuoi simulare, clicca sul bottone simula per avviare la simulazione</strong></p>
                    <p>altrimenti modifica i parametri e clicca sul bottone crea tappeto.</p>
                {% elif bottone == 'crea' and tipo_take == 'take_singolo' %}
                    <br />
                    <p>Nella tabella in alto a destra trovi la struttura del tappeto che hai appena creato.</p>
                    <p><strong>Se la struttura corrisponde a quello che vuoi simulare, clicca sul bottone simula per avviare la simulazione</strong></p>
                    <p>altrimenti modifica i parametri e clicca sul bottone crea tappeto.</p>
                {% endif %}
            </div>
		</div>
		<div class="col-md-7">
            <div class="panel panel-success" id="guida" style="display: none">
                <div class="panel-heading">Guida<button class="btn btn-default pull-right" type="button" id="bottone_guida_chiudi">Chiudi Guida</button>
                </div>
                <div class="panel-body">
                    <div class="col-md-12">
                        <table class="table table-hover stripe">
                            <thead>
                                <tr>
                                    <th>
                                        Nome campo
                                    </th>
                                    <th>
                                        Spiegazione
                                    </th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>
                                        <strong>Titolo</strong>
                                    </td>
                                    <td>
                                        Scegli dal menù a tendina il titolo su cui vuoi effettuare la simulazione.
                                    </td>
                                </tr>
                                <tr>
                                    <td>
                                        <strong>Data inizio</strong>
                                    </td>
                                    <td>
                                        La data di inizio della simulazione nel formato gg/mm/aaaa.
                                    </td>
                                </tr>
                                <tr>
                                    <td>
                                        <strong>Data fine</strong>
                                    </td>
                                    <td>
                                        La data di fine della simulazione nel formato gg/mm/aaaa.
                                    </td>
                                </tr>
                                <tr>
                                    <td>
                                        <strong>Limite inferiore</strong>
                                    </td>
                                    <td>
                                        Il limite inferiore del tappeto.
                                    </td>
                                </tr>
                                <tr>
                                    <td>
                                        <strong>Limite superiore</strong>
                                    </td>
                                    <td>
                                        Il limite superiore del tappeto. Corrisponde al prezzo di vendita dell'ultimo pacco.
                                    </td>
                                </tr>
                                <tr>
                                    <td>
                                        <strong>Livello primo acquisto</strong>
                                    </td>
                                    <td>
                                        Al di sotto di questo pacco (incluso), i pacchi saranno in stato Acquisto. Al di sopra saranno in stato vendita.
                                    </td>
                                </tr>
                                <tr>
                                    <td>
                                        <strong>Numero pacchi in carico</strong>
                                    </td>
                                    <td>
                                        Indica quanti pacchi hai in carico nel tuo portafoglio. Ad esempio per un tappeto su FCA con limiti 5-10, step 0.1 e dimensione pacco 100, ipotizziamo che abbia 1000 azioni in portafoglio. Divido le azioni per la dimensione del pacco: 1000/100 = 10. Vuol dire che ho 10 pacchi in carico.
                                        Se il livello primo acquisto è &euro; 6, il simulatore segnerà in carico i pacchi da &euro; 6.1 a &euro; 7.0.
                                        Se vuoi caricare dei pacchi short, inserisci un numero negativo di pacchi in carico (esempio: -6 per avere 6 pacchi short in carico).
                                    </td>
                                </tr>
                                <tr>
                                    <td>
                                        <strong>Step</strong>
                                    </td>
                                    <td>
                                        Lo step del tappeto.
                                    </td>
                                </tr>
                                {% if user.is_authenticated and perms.simulatore.take_variabile %}
                                <tr>
                                    <td>
                                        <strong>Take iniziale</strong>
                                    </td>
                                    <td>
                                        Il take da cui vuoi far partire la simulazione a take variabile.
                                    </td>
                                </tr>
                                <tr>
                                    <td>
                                        <strong>Take finale</strong>
                                    </td>
                                    <td>
                                        Il take a cui vuoi far fermare la simulazione a take variabile.
                                    </td>
                                </tr>
                                <tr>
                                    <td>
                                        <strong>Incremento del take</strong>
                                    </td>
                                    <td>
                                        La quantità di incremento del take. Ad esempio per simulare tutti i take possibili da &euro; 0.1 a &euro; 0.4, imposto come Take iniziale &euro; 0,1, come Take finale &euro; 0.4 e come incremento &euro; 0.01
                                        Per ogni simulazione puoi simulare al massimo 50 diversi take.
                                    </td>
                                </tr>
                                {% else %}
                                <tr>
                                    <td>
                                        <strong>Take</strong>
                                    </td>
                                    <td>
                                        Il take del tappeto.
                                    </td>
                                </tr>
                                {% endif %}
                                <tr>
                                    <td>
                                        <strong>Quantità acquisto</strong>
                                    </td>
                                    <td>
                                        La dimensione di acquisto di ogni singolo pacco.
                                    </td>
                                </tr>
                                <tr>
                                    <td>
                                        <strong>Quantità vendita</strong>
                                    </td>
                                    <td>
                                        La dimensione di vendita di ogni singolo pacco.
                                    </td>
                                </tr>
                                <tr>
                                    <td>
                                        <strong>Tipo commissioni</strong>
                                    </td>
                                    <td>
                                        Puoi scegliere tra commissioni fisse o percentuali.
                                    </td>
                                </tr>
                                <tr>
                                    <td>
                                        <strong>Importo commissioni</strong>
                                    </td>
                                    <td>
                                        Tipo commissione fissa --> inserisci il valore in &euro; della commissione fissa.<br/>
                                        Tipo commissione percentuale --> inserisci il valore percentuale della commissione. Ad esempio se la tua commissione è 0.19%, scrivi 0.19.
                                    </td>
                                </tr>
                                <tr>
                                    <td>
                                        <strong>Commissione minima</strong>
                                    </td>
                                    <td>
                                        Inserici il valore in &euro; minimo della commissione.
                                    </td>
                                </tr>
                                <tr>
                                    <td>
                                        <strong>Commissione massima</strong>
                                    </td>
                                    <td>
                                        Inserisci il valore in &euro; massimo della commissione.
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
			{% if bottone == 'crea' %}
            <table class="table table-fabio table-condensed table-bordered table-hover stripe" id="tabella_tappeto" style="font-size: 10px; text-align: center">
				<thead>
					<tr>
						<th>
							#
						</th>
						<th>
							Stato
						</th>
						<th>
							Prezzo&#13;&#10;acquisto
						</th>
						<th>
							Prezzo&#13;&#10;vendita
						</th>
                        <th>
							Quantità&#13;&#10;acquisto
						</th>
                        <th>
							Quantità&#13;&#10;vendita
						</th>
                        <th>
							In carico
						</th>
					</tr>
				</thead>
				<tbody>
					{% for pacco in primo_tappeto.pacchi %}
                    <tr>
						<td>
                            {{ forloop.counter }}
						</td>
						<td>
							{% if pacco.order_type == 'VENAZ_L' %}VENDITA LONG{% elif pacco.order_type == 'ACQAZ_L' %}ACQUISTO LONG{% elif pacco.order_type == 'VENAZ_S' %}VENDITA SHORT{% elif pacco.order_type == 'ACQAZ_S' %}ACQUISTO SHORT{% endif %}
						</td>
						<td>
							{{ pacco.buy_price }}
						</td>
						<td>
							{{ pacco.sell_price }}
						</td>
                        <td>
							{{ pacco.quantity_buy }}
						</td>
                        <td>
							{{ pacco.quantity_sell }}
						</td>
                        <td>
							{% if pacco.carica == 1 %}
							    SI
                            {% else %}
                                NO
							{% endif %}
						</td>
					</tr>
                    {% endfor %}
				</tbody>
			</table>
            {% elif bottone == 'simula' %}
            <h3 class="text-center">
				Risultato simulazioni per {{ isin }}&#13;&#10;Data inizio: {{ data_inizio }} - Data fine: {{ data_fine }}
			</h3>
            <table class="table table-condensed table-bordered table-hover stripe" id="tabella_risultato_simulazione" style="font-size: 12px; text-align: center">
				<thead>
					<tr>
						<th style="padding: 5px 5px; vertical-align: middle">
							Inizio
						</th>
						<th style="padding: 5px 5px; vertical-align: middle">
							Fine
						</th>
						<th style="padding: 5px 5px; vertical-align: middle">
							Primo<br/>acquisto
						</th>
						<th style="padding: 5px 5px; vertical-align: middle">
							Step
						</th>
                        <th style="padding: 5px 5px; vertical-align: middle">
							Take
						</th>
                        <th style="padding: 5px 5px; vertical-align: middle">
							Quantità<br/>acquisto
						</th>
                        <th style="padding: 5px 5px; vertical-align: middle">
							Quantità<br/>vendita
						</th>
                        <th style="padding: 5px 5px; vertical-align: middle">
							Acquisti
						</th>
                        <th style="padding: 5px 5px; vertical-align: middle">
							Vendite
						</th>
                        <th style="padding: 5px 5px; vertical-align: middle">
							Gain
						</th>
                        <th style="padding: 5px 5px; vertical-align: middle">
							Commissioni
						</th>
                        <th style="padding: 5px 5px; vertical-align: middle">
							Profitto
						</th>
                        <th style="padding: 5px 5px; vertical-align: middle">
							Rendimento
						</th>
                        <th style="padding: 5px 5px; vertical-align: middle">
                            Valore<br/>massimo
                        </th>
					</tr>
				</thead>
				<tbody>
					{% for Tappeto in tappeto %}
                    <tr>
						<td style="padding: 5px 5px">
							&euro; {{ Tappeto.limite_inferiore }}
						</td>
						<td style="padding: 5px 5px">
							&euro; {{ Tappeto.limite_superiore }}
						</td>
						<td style="padding: 5px 5px">
							&euro; {{ Tappeto.primo_acquisto }}
						</td>
						<td style="padding: 5px 5px">
							&euro; {{ Tappeto.step }}
						</td>
                        <td style="padding: 5px 5px">
							&euro; {{ Tappeto.take }}
						</td>
                        <td style="padding: 5px 5px">
							{{ Tappeto.quantita_acquisto }}
						</td>
                        <td style="padding: 5px 5px">
							{{ Tappeto.quantita_vendita }}
						</td>
                        <td style="padding: 5px 5px">
							{{ Tappeto.nr_acquisti }}
						</td>
                        <td style="padding: 5px 5px">
							{{ Tappeto.nr_vendite }}
						</td>
                        <td style="padding: 5px 5px">
							&euro; {{ Tappeto.gain }}
						</td>
                        <td style="padding: 5px 5px">
							&euro; {{ Tappeto.commissioni }}
						</td>
                        <td style="padding: 5px 5px">
							&euro; {{ Tappeto.profitto }}
						</td>
                        <td style="padding: 5px 5px">
							{{ Tappeto.rendimento }}%
						</td>
                        <td style="padding: 5px 5px">
                            &euro; {{ Tappeto.valore_max }}
                        </td>
					</tr>
                    {% endfor %}
				</tbody>
			</table>
            {% endif %}
		</div>
	</div>
	<div class="row" {% if bottone != 'simula' %} hidden {% endif %}>
		{% for singolo_tappeto in tappeto %}
        <div class="col-md-6" {% if not singolo_tappeto.take == best_take %}style="display: none"{% endif %} id="dettagli_operazioni_{{ singolo_tappeto.take|cut:"." }}">
			<h4 class="text-center">
				Dettaglio operazioni per take &euro; {{ singolo_tappeto.take }}
			</h4>
			<table class="table table-condensed table-hover stripe table-fabio" style="font-size: 10px; text-align: center">
				<thead>
					<tr>
						<th>
							Data
						</th>
						<th>
							Ora
						</th>
						<th>
							Pacco
						</th>
                        <th>
							Operazione
						</th>
						<th>
							Prezzo
						</th>
                        <th>
							Quantità
						</th>
                        <th>
							Gain
						</th>
                        <th>
							Commissioni
						</th>
                        <th>
							Profitto
						</th>
					</tr>
				</thead>
				<tbody>
					{% for item in singolo_tappeto.operazioni %}
                    <tr>
						<td>
							{{ item.data }}
						</td>
						<td>
							{{ item.ora }}
						</td>
						<td>
							&euro; {{ item.prezzo_teorico }}
						</td>
						<td>
							{% if item.tipo == 'VENAZ_L' %}VENDITA LONG{% elif item.tipo == 'ACQAZ_L' %}ACQUISTO LONG{% elif item.tipo == 'VENAZ_S' %}VENDITA SHORT{% elif item.tipo == 'ACQAZ_S' %}ACQUISTO SHORT{% endif %}
						</td>
                        <td>
							&euro; {{ item.prezzo }}
						</td>
                        <td>
							{{ item.quantita }}
						</td>
                        <td>
							&euro; {{ item.gain }}
						</td>
                        <td>
							&euro; {{ item.commissioni }}
						</td>
                        <td>
							&euro; {{ item.profitto }}
						</td>
					</tr>
                    {% endfor %}
				</tbody>
			</table>
		</div>
        {% endfor %}
		<div class="col-md-3">
			{% if take_array_size > 1 %}
            <table class="table table-hover table-condensed">
				<thead>
					<tr>
						<th>
							Data
						</th>
						<th>
							Miglior take
						</th>
					</tr>
				</thead>
				<tbody>
					{% for item in take_array %}
                    <tr>
						<td>
							1
						</td>
						<td>
							{{ item }}
						</td>
					</tr>
                    {% endfor %}
				</tbody>
			</table>
            {% endif %}
		</div>
	</div>
    <script type="text/javascript">
   $(document).ready(function() {
       var curr = new Date();
       curr.setDate(curr.getDate() - 15);
       //convert month to 2 digits
       var twoDigitMonth = curr.getMonth()+1+"";if(twoDigitMonth.length==1)	twoDigitMonth="0" +twoDigitMonth;
       var twoDigitDate = curr.getDate()+"";if(twoDigitDate.length==1)	twoDigitDate="0" +twoDigitDate;
       window.currentDate = twoDigitDate + "/" + twoDigitMonth + "/" + curr.getFullYear();
   $('#take_singolo').formValidation({
        // I am validating Bootstrap form
        framework: 'bootstrap',

        // Feedback icons
        icon: {
            valid: 'checkmark icon',
            invalid: 'glyphicon glyphicon-remove',
            validating: 'glyphicon glyphicon-refresh'
        },

        // List of fields and their validation rules
        fields: {
            crea_data_inizio:{
                validators: {
                    notEmpty: {
                        message: "La data inizio è obbligatoria"
                    }
                }
            },
            selectedDate_inizio: {
                // The hidden input will not be ignored
                excluded: false,
                validators: {
                    notEmpty: {
                        message: 'La data inizio è obbligatoria'
                    },
                    date: {
                        format: 'DD/MM/YYYY',
                        min: window.currentDate,
                        message: 'La data inizio non è in un formato valido gg/mm/aaaa'
                    }
                }
            },
            selectedDate_fine: {
                // The hidden input will not be ignored
                excluded: false,
                validators: {
                    notEmpty: {
                        message: 'La data fine è obbligatoria'
                    },
                    date: {
                        format: 'DD/MM/YYYY',
                        min: 'selectedDate_inizio',
                        message: 'La data fine deve essere maggiore della data inizio'
                    }
                }
            },
            crea_quantita_acquisto: {
                validators: {
                    between: {
                        min: 1,
                        message: 'La quantità in acquisto deve essere almeno uno'
                    }
                }
            },
            crea_quantita_vendita: {
                validators: {
                    between: {
                        min: 1,
                        message: 'La quantità in vendita deve essere almeno uno'
                    }
                }
            },
            crea_primo_acquisto: {
                validators: {
                    between: {
                        min: 'crea_limite_inferiore',
                        max: 'crea_limite_superiore',
                        message: 'Il primo acquisto deve essere tra il limite inferiore e superiore'
                    }
                }
            }
        }
   });
   $('#take_variabile').formValidation({
        // I am validating Bootstrap form
        framework: 'bootstrap',

        // Feedback icons
        icon: {
            valid: 'checkmark icon',
            invalid: 'glyphicon glyphicon-remove',
            validating: 'glyphicon glyphicon-refresh'
        },
        live: 'submitted',
        // List of fields and their validation rules
        fields: {
            crea_data_fine:{
                validators: {
                    notEmpty: {
                        message: "La data inizio è obbligatoria"
                    }
                }
            },
            selectedDate_variabile_inizio: {
                // The hidden input will not be ignored
                excluded: false,
                validators: {
                    notEmpty: {
                        message: 'La data inizio è obbligatoria'
                    },
                    date: {
                        format: 'DD/MM/YYYY',
                        message: 'La data inizio non è in un formato valido gg/mm/aaaa'
                    }
                }
            },
            selectedDate_variabile_fine: {
                // The hidden input will not be ignored
                excluded: false,
                validators: {
                    notEmpty: {
                        message: 'La data fine è obbligatoria'
                    },
                    date: {
                        format: 'DD/MM/YYYY',
                        min: 'selectedDate_variabile_inizio',
                        message: 'La data fine deve essere maggiore della data inzio'
                    }
                }
            },
            crea_quantita_acquisto: {
                validators: {
                    between: {
                        min: 1,
                        message: 'La quantità in acquisto deve essere almeno uno'
                    }
                }
            },
            crea_quantita_vendita: {
                validators: {
                    between: {
                        min: 1,
                        message: 'La quantità in vendita deve essere almeno uno'
                    }
                }
            },
            crea_primo_acquisto: {
                validators: {
                    between: {
                        min: 'crea_limite_inferiore',
                        max: 'crea_limite_superiore',
                        message: 'Il primo acquisto deve essere tra il limite inferiore e superiore'
                    }
                }
            },
            take_fine: {
                verbose: false,
                validators: {
                    greaterThan: {
                        value: 'take_inizio',
                        message: 'Il take finale deve essere maggiore del take iniziale'
                    },
                    callback: {
                            message: 'Puoi simulare al massimo 50 tappeti. Modifica i take iniziale e finale o l\'incremento',
                            callback: function (value, validator, $field) {
                                var take_inizio = validator.getFieldElements('take_inizio').val();
                                var take_fine = validator.getFieldElements('take_fine').val();
                                var take_incremento = validator.getFieldElements('take_incremento').val();
                                var numero_tappeti = (take_fine - take_inizio) / take_incremento;

                                if (numero_tappeti > 50) {
                                    return false;
                                }
                                validator.updateStatus('take_fine', 'VALID', 'callback');
                                //str = JSON.stringify(numero_tappeti);
                                //str = JSON.stringify(take_fine, null, 4); // (Optional) beautiful indented output.
                                //console.log(str); // Logs output to dev tools console.
                                //alert(str); // Displays output using window.alert()

                                return true;
                            }
                        }
                    }
            }
        }
    });
   });

</script>
{% endblock %}